% alpha, beta, incircle-area of right hat, rounding
\pgfmathsetmacro{\a}{(\defaulta)}
\pgfmathsetmacro{\b}{(\defaultb)}
\pgfmathsetmacro{\x}{(\defaultx)}
\pgfmathsetmacro{\round}{0}
\pgfmathsetmacro{\f}{(cos(\b/2)^2*sec(\a/2+\b/2)^2*(1-sin(\a)))}
\pgfmathsetmacro{\g}{(cos(\a/2)^2*sec(\a/2+\b/2)^2*(1-sin(\b)))}

\hatshape{1}{\round}{\a}{\b}

\pgfmathparse{sqrt(1/pi)/tan(\b/2)-sqrt(((\x))/pi)/tan(\b/2)}
\begin{scope}[shift={(\pgfmathresult,0)}]
    \pgfmathparse{sqrt(1/pi)-sqrt(\x/pi)}
    \begin{scope}[shift={(0,-\pgfmathresult)}]
        \pgfmathsetmacro{\hata}{\x}
        \pgfmathsetmacro{\hatb}{max(\round,\x-\g*(1-\x)/(\f)))}
        \pgfmathsetmacro{\origa}{\a}
        \hatshape[draw=none,filled2]{\hata}{\hatb}{90}{\b}
        \draw[dashed] (midcenter) circle(\r) node {$a_i$};
        \draw[dashed] (topcenter) circle(\s) node {$b_i$};
        \draw[bracket] ([shift={(19pt,19pt)}]top) -- node[sloped,above] {$d\sqrt{a_i}$} ([shift={(19pt,19pt)}]right);

        \begin{scope}[shift={(topcenter)}]
            \hatshape{\hatb}{0}{\origa}{\b}
            \draw[bracket] ([shift={(1pt,1pt)}]top) -- node[sloped,above] {$e\sqrt{b_i}$} ([shift={(1pt,1pt)}]right);
            \hatshape{\hatb}{0}{90}{\b}
            \draw[bracket] ([shift={(7pt,7pt)}]top) -- node[sloped,above] {$d\sqrt{b_i}$} ([shift={(7pt,7pt)}]right);
        \end{scope}

        \hatshape{\hata}{0}{90}{\b}
    \end{scope}
\end{scope}

\pgfmathparse{sqrt(1/pi)/tan(\b/2)-sqrt((\g)/pi)/tan(\b/2)}
\begin{scope}[shift={(\pgfmathresult,0)}]
    \pgfmathparse{sqrt(1/pi)-sqrt((\g)/pi)}
    \begin{scope}[shift={(0,-\pgfmathresult)}]
        \hatshape{\g}{0}{90}{\b}
        \draw[dashed] (midcenter) circle(\r) node {$f_i$};
        \draw[bracket] ([shift={(13pt,13pt)}]top) -- node[sloped,above] {$d\sqrt{f_i}$} ([shift={(13pt,13pt)}]right);
    \end{scope}
\end{scope}

%\def\comparg{\x}
%\if\comparg1\else
%    \pgfmathparse{sqrt(1/pi)/tan(\a/2)-sqrt(((1-\x))/pi)/tan(\a/2)}
%    \begin{scope}[shift={(-\pgfmathresult,0)}]
%        \pgfmathparse{sqrt(1/pi)-sqrt((1-\x)/pi)}
%        \begin{scope}[shift={(0,-\pgfmathresult)}]
%            \pgfmathsetmacro{\hata}{1-\x}
%            \hatshape[dashed]{\hata}{0}{\a}{\b}
%            \pgfmathsetmacro{\r}{sqrt((1-\x)/pi)}
%            \draw (midcenter) circle(\r) node {$a_1$};
%        \end{scope}
%    \end{scope}
%\fi
